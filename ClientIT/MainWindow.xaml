<Window
    x:Class="ClientIT.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ClientIT"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:ClientIT.Models"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop/>
    </Window.SystemBackdrop>

    <!-- Layout Principale a 2 colonne (1/12 e 11/12) -->
    <Grid x:Name="RootGrid" Padding="12">
        <!-- IMPORTANTE: ColumnDefinitions DEVE stare PRIMA del contenuto -->
        <Grid.ColumnDefinitions>
            <!-- Colonna Sinistra (Utenti IT) - 1/12 (approx) -->
            <ColumnDefinition Width="1*" MinWidth="150"/>
            <!-- Colonna Destra (Ticket) - 11/12 (approx) -->
            <ColumnDefinition Width="11*"/>
        </Grid.ColumnDefinitions>

        <!-- ProgressRing per il caricamento (sovrapposto a tutto) -->
        <ProgressRing x:Name="LoadingProgressRing" 
                      Grid.ColumnSpan="2"
                      IsActive="False"
                      Visibility="Collapsed"
                      Width="50" 
                      Height="50"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Canvas.ZIndex="999"/>

        <!-- === COLONNA SINISTRA (Utenti IT) === -->
        <Border Grid.Column="0" 
                Background="{ThemeResource LayerFillColorDefaultBrush}" 
                CornerRadius="8" 
                BorderThickness="1" 
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                Margin="0,0,12,0">

            <ListView x:Name="UserListView" 
                      Margin="4"
                      SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:ItUtente">
                        <StackPanel Padding="8">
                            <TextBlock Text="{x:Bind UsernameAd}" FontWeight="Bold"/>
                            <TextBlock Text="{x:Bind Permesso}" FontSize="12" Opacity="0.8"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

        </Border>

        <!-- === COLONNA DESTRA (Ticket) === -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="8">
                <!-- Messaggio di Benvenuto -->
                <TextBlock x:Name="WelcomeMessage" 
                           Style="{ThemeResource TitleTextBlockStyle}" 
                           Margin="0,0,0,12"/>

                <!-- Lista dei Ticket -->
                <ListView x:Name="TicketListView" 
                          SelectionMode="Single"
                          HorizontalContentAlignment="Stretch">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:TicketViewModel">

                            <!-- Bordo esterno per ogni riga di ticket -->
                            <Border Background="{ThemeResource LayerFillColorDefaultBrush}" 
                                    CornerRadius="8" 
                                    BorderThickness="1" 
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    Padding="16" 
                                    Margin="0,0,0,8">
                                <StackPanel Spacing="8">

                                    <!-- Riga per Titolo e Numero Ticket -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Titolo (in grande) -->
                                        <TextBlock Grid.Column="0" 
                                                   Text="{x:Bind Titolo}" 
                                                   Style="{ThemeResource SubtitleTextBlockStyle}" 
                                                   FontWeight="Bold" 
                                                   VerticalAlignment="Center"/>
                                        <!-- N. Ticket (a destra) -->
                                        <TextBlock Grid.Column="1" 
                                                   Text="{x:Bind Nticket}" 
                                                   Opacity="0.7" 
                                                   VerticalAlignment="Center"/>
                                    </Grid>

                                    <!-- Riga per i "Badge" -->
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <!-- Badge Tipologia -->
                                        <Border Background="{ThemeResource AccentFillColorDefaultBrush}" 
                                                CornerRadius="4" 
                                                Padding="8,4">
                                            <TextBlock Text="{x:Bind TipologiaNome}" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"/>
                                        </Border>
                                        <!-- Badge Urgenza -->
                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                                CornerRadius="4" 
                                                Padding="8,4">
                                            <TextBlock Text="{x:Bind UrgenzaNome}" 
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorPrimary}"/>
                                        </Border>
                                        <!-- Badge Sede -->
                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                                CornerRadius="4" 
                                                Padding="8,4">
                                            <TextBlock Text="{x:Bind SedeNome}" 
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorPrimary}"/>
                                        </Border>
                                    </StackPanel>

                                    <!-- Riga per Utente e Macchina -->
                                    <TextBlock Opacity="0.8" 
                                               FontSize="12" 
                                               Margin="0,8,0,0">
                                        <Run Text="Inviato da:"/>
                                        <Run Text="{x:Bind Username}" FontWeight="Bold"/>
                                        <Run Text=" | Macchina: "/>
                                        <Run Text="{x:Bind Macchina}" FontWeight="Bold"/>
                                    </TextBlock>

                                </StackPanel>
                            </Border>

                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</Window>